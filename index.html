<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Inscripción a Cursos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <!-- 
    =============================================================================
    == CONFIGURACIÓN OBLIGATORIA
    =============================================================================
    == Reemplaza la siguiente URL de ejemplo con la URL de tu Google Apps Script.
    == Esta es la URL que copiaste al final de la Parte 2 de las instrucciones.
    =============================================================================
    -->
    <script>
      window.CONFIG = {
        APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbywqbnoE7o6nZHLR9vjipoRRqo_Pv1qNZ-lPeoqvW_vEgEjYm-g-iX3P764THe_BI_5/exec'
      };
    </script>
    
    <script type="module">
        // --- BUNDLED REACT APPLICATION ---
        // This code is compiled and contains the entire application logic.
        // Do not edit this code directly. Use the CONFIG block above.
        const e=React,t=ReactDOM;const n=()=>e.createElement("header",{className:"bg-white shadow-md"},e.createElement("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8"},e.createElement("div",{className:"flex items-center justify-between h-24"},e.createElement("div",{className:"flex-shrink-0"},e.createElement("img",{className:"h-16 md:h-20",src:"https://raw.githubusercontent.com/DA-itd/web/main/logo_itdurango.png",alt:"Logo Instituto Tecnológico de Durango"})),e.createElement("div",{className:"text-center"},e.createElement("h1",{className:"text-xl md:text-2xl font-bold text-blue-900"},"SISTEMA DE INSCRIPCIÓN A CURSOS DE ACTUALIZACIÓN DOCENTE"),e.createElement("h2",{className:"text-md md:text-lg text-blue-900"},"INSTITUTO TECNOLÓGICO DE DURANGO")))));const a=()=>e.createElement("footer",{className:"bg-blue-800 text-white text-center p-4 mt-auto"},e.createElement("p",{className:"font-semibold"},"COORDINACIÓN DE ACTUALIZACIÓN DOCENTE - Desarrollo Académico"),e.createElement("p",{className:"text-sm"},"Todos los derechos reservados 2026."));const o=({currentStep:t,steps:n})=>e.createElement("div",{className:"w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},e.createElement("div",{className:"flex items-start"},n.map((a,o)=>e.createElement(e.Fragment,{key:o},e.createElement("div",{className:"flex flex-col items-center w-1/4"},e.createElement("div",{className:"relative flex items-center justify-center"},e.createElement("div",{className:`w-10 h-10 flex items-center justify-center z-10 rounded-full font-semibold text-white ${o<t?"bg-rose-800":"bg-gray-300"} ${o===t-1&&"ring-4 ring-rose-300"}`},o+1),o<n.length-1&&e.createElement("div",{className:`absolute w-full top-1/2 -translate-y-1/2 left-1/2 h-1 ${o<t-1?"bg-rose-800":"bg-gray-300"}`})),e.createElement("div",{className:"mt-2 text-center"},e.createElement("p",{className:`text-sm font-medium ${o<t?"text-rose-800":"text-gray-500"}`},a))))));const s=({teachers:t,onSelect:n})=>{const[a,o]=e.useState(""),[s,r]=e.useState([]),[i,l]=e.useState(!1);e.useEffect(()=>{if(a.length>2){const e=t.filter(e=>e.nombreCompleto.toLowerCase().includes(a.toLowerCase())).slice(0,5);r(e)}else r([])},[a,t]);const c=d=>{o(d.nombreCompleto),n(d),r([]),l(!1)},p=d=>{d.target.value.length>2?l(!0):l(!1)};return e.createElement("div",{className:"relative"},e.createElement("input",{type:"text",value:a,onChange:e=>{o(e.target.value.toUpperCase()),n(null)},onFocus:p,onBlur:()=>setTimeout(()=>l(!1),200),placeholder:"Escriba su nombre completo",className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",required:!0}),i&&s.length>0&&e.createElement("ul",{className:"absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg mt-1 max-h-60 overflow-auto"},s.map(t=>e.createElement("li",{key:t.curp,onClick:()=>c(t),className:"px-4 py-2 hover:bg-gray-100 cursor-pointer"},t.nombreCompleto))))},r=({formData:t,setFormData:n,departments:a,teachers:r,onNext:i})=>{const[l,c]=e.useState({fullName:"",curp:"",email:""});const p=d=>{d.preventDefault();const e={...l,...t};for(const n in e)if("object"!=typeof e[n]&&!e[n])return void c(a=>({...a,[n]:"Este campo es obligatorio."}));if(t.curp.length<18)return void c(e=>({...e,curp:"El CURP debe tener 18 caracteres."}));if(!/^\S+@\S+\.\S+$/.test(t.email))return void c(e=>({...e,email:"El formato del email no es válido."}));i()},d=e=>{n(t=>({...t,[e.target.name]:e.target.value}))},u=e=>{d(e),"email"===e.target.name&&n(t=>({...t,email:e.target.value.toLowerCase()}))},m=e=>{if(e){const{nombreCompleto:a,curp:o,email:s}=e;n(t=>({...t,fullName:a||"",curp:o||"",email:s||""}))}else n(e=>({...e,fullName:"",curp:"",email:""}))};return e.createElement("div",{className:"bg-white p-8 rounded-lg shadow-md w-full max-w-4xl mx-auto"},e.createElement("h2",{className:"text-2xl font-bold mb-6 text-gray-800"},"Información Personal"),e.createElement("form",{onSubmit:p,noValidate:!0},e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6"},e.createElement("div",null,e.createElement("label",{htmlFor:"fullName",className:"block text-sm font-medium text-gray-700"},"Nombre Completo *"),e.createElement(s,{teachers:r,onSelect:m}),l.fullName&&e.createElement("p",{className:"text-red-500 text-xs mt-1"},l.fullName)),e.createElement("div",null,e.createElement("label",{htmlFor:"curp",className:"block text-sm font-medium text-gray-700"},"CURP *"),e.createElement("input",{type:"text",name:"curp",id:"curp",value:t.curp,onChange:d,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"18 caracteres",maxLength:18,required:!0}),l.curp&&e.createElement("p",{className:"text-red-500 text-xs mt-1"},l.curp)),e.createElement("div",null,e.createElement("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700"},"Email Institucional *"),e.createElement("input",{type:"email",name:"email",id:"email",value:t.email,onChange:u,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"nombre@itdurango.edu.mx",required:!0}),l.email&&e.createElement("p",{className:"text-red-500 text-xs mt-1"},l.email)),e.createElement("div",null,e.createElement("label",{htmlFor:"gender",className:"block text-sm font-medium text-gray-700"},"Género *"),e.createElement("select",{name:"gender",id:"gender",value:t.gender,onChange:d,className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",required:!0},e.createElement("option",null,"Mujer"),e.createElement("option",null,"Hombre"),e.createElement("option",null,"Otro"))),e.createElement("div",{className:"md:col-span-2"},e.createElement("label",{htmlFor:"department",className:"block text-sm font-medium text-gray-700"},"Departamento *"),e.createElement("select",{name:"department",id:"department",value:t.department,onChange:d,className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",required:!0},e.createElement("option",{value:""},"Seleccione un departamento"),a.map(t=>e.createElement("option",{key:t,value:t},t))),l.department&&e.createElement("p",{className:"text-red-500 text-xs mt-1"},l.department))),e.createElement("div",{className:"mt-8 flex justify-end"},e.createElement("button",{type:"submit",className:"bg-rose-800 text-white font-bold py-2 px-6 rounded-lg hover:bg-rose-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-rose-700"},"Continuar"))))},i=({courses:t,selectedCourses:n,setSelectedCourses:a,onNext:o,onBack:s})=>{const[r,i]=e.useState(null),l=c=>{const e=n.some(e=>e.id===c.id),t=n.filter(e=>e.id!==c.id);if(e)a(t);else{if(n.length>=3)return void i("No puede seleccionar más de 3 cursos.");const o=n.some(e=>e.period===c.period);if(o)return void i("Ya ha seleccionado un curso para este periodo.");const s=n.some(e=>{const t=e.schedule.split(" a ").map(e=>parseInt(e.replace(":",""))),n=c.schedule.split(" a ").map(e=>parseInt(e.replace(":","")));return e.dates===c.dates&&Math.max(t[0],n[0])<Math.min(t[1],n[1])});if(s)return void i("El horario de este curso se solapa con otro curso seleccionado.");a([...n,c])}i(null)},c=e=>{const t=n.some(t=>t.period===e.period);return n.some(t=>t.id===e.id)?`ring-2 ring-offset-2 ${"PERIODO_1"===e.period?"ring-teal-500":"ring-indigo-500"}`:t?"opacity-50 bg-gray-200 cursor-not-allowed":"bg-white"},p=d=>{d.preventDefault(),n.length>0?o():i("Debe seleccionar al menos un curso.")};return e.createElement("div",{className:"bg-white p-8 rounded-lg shadow-md w-full max-w-4xl mx-auto"},e.createElement("h2",{className:"text-2xl font-bold mb-2 text-gray-800"},"Selección de Cursos"),e.createElement("p",{className:"text-gray-600 mb-6"},"Seleccione hasta 3 cursos de actualización. Los cursos están organizados por periodo."),e.createElement("div",{className:"bg-blue-50 border-l-4 border-blue-500 text-blue-700 p-4 mb-6 rounded-md",role:"alert"},e.createElement("p",{className:"font-bold"},"Cursos seleccionados: ",n.length," / 3")),r&&e.createElement("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded-md",role:"alert"},e.createElement("p",null,r)),e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},t.map(t=>e.createElement("div",{key:t.id,onClick:()=>{n.some(e=>e.period===t.period)&&!n.some(e=>e.id===t.id)?i("Ya ha seleccionado un curso para este periodo."):l(t)},className:`p-3 rounded-lg border transition-all duration-200 cursor-pointer ${c(t)} ${"PERIODO_1"===t.period?"border-teal-300 hover:border-teal-500 bg-teal-50":"border-indigo-300 hover:border-indigo-500 bg-indigo-50"}`},e.createElement("div",{className:"flex items-start justify-between"},e.createElement("div",{className:"flex-grow pr-2"},e.createElement("h3",{className:"font-bold text-sm text-gray-800"},t.name),e.createElement("p",{className:"text-xs text-gray-500 mt-1"},"Fechas: ",t.dates)),e.createElement("input",{type:"checkbox",checked:n.some(e=>e.id===t.id),readOnly:!0,className:"form-checkbox h-5 w-5 text-blue-600 rounded cursor-pointer"}))))),e.createElement("form",{onSubmit:p},e.createElement("div",{className:"mt-8 flex justify-between"},e.createElement("button",{type:"button",onClick:s,className:"bg-gray-300 text-gray-800 font-bold py-2 px-6 rounded-lg hover:bg-gray-400"},"Regresar"),e.createElement("button",{type:"submit",className:"bg-rose-800 text-white font-bold py-2 px-6 rounded-lg hover:bg-rose-900"},"Continuar"))))},l=({formData:t,onBack:n,onSubmit:a,courses:o})=>{const[s,r]=e.useState(!1);const i=async()=>{r(!0);try{await a()}catch(e){console.error("Submission error:",e)}finally{r(!1)}};return e.createElement("div",{className:"bg-white p-8 rounded-lg shadow-md w-full max-w-4xl mx-auto"},e.createElement("h2",{className:"text-2xl font-bold mb-6 text-gray-800"},"Confirmación de Registro"),e.createElement("div",{className:"border border-gray-200 rounded-lg p-6 mb-6"},e.createElement("h3",{className:"text-lg font-semibold text-gray-700 mb-4"},"Resumen de su Registro"),e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"},e.createElement("div",null,e.createElement("p",null,e.createElement("strong",null,"ID de Registro: "),"TNM-054-02-2026-18"),e.createElement("p",null,e.createElement("strong",null,"CURP: "),t.curp),e.createElement("p",null,e.createElement("strong",null,"Género: "),t.gender)),e.createElement("div",null,e.createElement("p",null,e.createElement("strong",null,"Nombre: "),t.fullName),e.createElement("p",null,e.createElement("strong",null,"Email: "),t.email),e.createElement("p",null,e.createElement("strong",null,"Departamento: "),t.department)))),e.createElement("div",{className:"mt-6"},e.createElement("h3",{className:"text-lg font-semibold text-gray-700 mb-4"},"Cursos Seleccionados"),e.createElement("div",{className:"space-y-4"},o.map(t=>e.createElement("div",{key:t.id,className:"border border-gray-200 rounded-lg p-4"},e.createElement("h4",{className:"font-bold text-gray-800"},t.name),e.createElement("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-2 mt-2 text-sm text-gray-600"},e.createElement("div",null,e.createElement("strong",null,"Horario: "),t.schedule),e.createElement("div",null,e.createElement("strong",null,"Lugar: "),t.location),e.createElement("div",null,e.createElement("strong",null,"Fechas: "),t.dates),e.createElement("div",null,e.createElement("strong",null,"Horas: "),t.horas||30)))))),e.createElement("div",{className:"mt-8 flex justify-between"},e.createElement("button",{onClick:n,className:"bg-gray-300 text-gray-800 font-bold py-2 px-6 rounded-lg hover:bg-gray-400",disabled:s},"Regresar"),e.createElement("button",{onClick:i,className:"bg-rose-800 text-white font-bold py-2 px-6 rounded-lg hover:bg-rose-900 flex items-center justify-center",disabled:s},s&&e.createElement("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},e.createElement("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.createElement("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})),s?"Procesando...":"Confirmar Registro"))))},c=({registrationId:t})=>e.createElement("div",{className:"bg-white p-8 rounded-lg shadow-md w-full max-w-2xl mx-auto text-center"},e.createElement("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4"},e.createElement("svg",{className:"h-8 w-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"}))),e.createElement("h2",{className:"text-2xl font-bold mb-2 text-green-700"},"¡Registro Exitoso!"),e.createElement("p",{className:"text-gray-600 mb-6"},"Su registro ha sido procesado correctamente. Recibirá un correo de confirmación con los detalles de sus cursos seleccionados."),e.createElement("div",{className:"bg-gray-100 border border-gray-200 rounded-lg p-4"},e.createElement("p",{className:"text-sm text-gray-500"},"ID de Registro:"),e.createElement("p",{className:"text-lg font-mono text-gray-800 font-semibold"},t)));async function p(e,t,n){const a=window.CONFIG.APPS_SCRIPT_URL;if(!a||a.includes("YOUR_DEPLOYMENT_ID"))return console.warn("MODO DE SIMULACIÓN: La URL de Google Apps Script no está configurada. Se devolverá una respuesta simulada."),new Promise(e=>{setTimeout(()=>{const t=formData.selectedCourses[0];let n="XX";if(t){const e=t.split("-");4===e.length&&(n=e[2])}const a="TNM-054-"+n+"-2026-"+(Math.floor(1e3*Math.random())+1);e({status:"success",registrationId:a})},1e3)});const o={...t,timestamp:new Date().toISOString(),selectedCourses:n.filter(e=>t.selectedCourses.includes(e.id)).map(e=>({id:e.id,name:e.name,dates:e.dates,location:e.location,schedule:e.schedule}))};try{const t=await fetch(a,{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!t.ok)throw new Error(`Error del servidor: ${t.status}`);const n=await t.json();if("error"===n.status)throw new Error(`Error de Apps Script: ${n.message}`);return n}catch(e){console.error("Error en submitRegistration:",e);let t="Error al enviar el registro. Por favor, inténtelo de nuevo más tarde.";throw"Failed to fetch"===e.message&&(t='Error de conexión. No se pudo contactar al servidor de registro. Por favor, revise su conexión a internet y verifique que la URL del script de Google sea correcta y esté desplegada con acceso para "Cualquier persona".'),new Error(t)}}const d={DEPARTAMENTOS:"https://raw.githubusercontent.com/DA-itd/web/main/departamentos.json",CURSOS:"https://raw.githubusercontent.com/DA-itd/web/main/cursos.json",DOCENTES:"https://raw.githubusercontent.com/DA-itd/web/main/docentes.json"};const u=()=>e.createElement(m,{});function m(){const[t,s]=e.useState(1),[r,i]=e.useState({fullName:"",curp:"",email:"",gender:"Mujer",department:"",selectedCourses:[]}),[l,u]=e.useState([]),[m,f]=e.useState([]),[h,g]=e.useState(["DEPARTAMENTO DE SISTEMAS Y COMPUTACION","DEPARTAMENTO DE INGENIERÍA ELÉCTRICA Y ELECTRÓNICA","DEPARTAMENTO DE CIENCIAS ECONOMICO-ADMINISTRATIVAS","DEPARTAMENTO DE INGENIERÍA QUÍMICA-BIOQUÍMICA","DEPARTAMENTO DE CIENCIAS DE LA TIERRA","DEPARTAMENTO DE CIENCIAS BASICAS","DEPARTAMENTO DE METAL-MECÁNICA","DEPARTAMENTO DE INGENIERÍA INDUSTRIAL","DIVISION DE ESTUDIOS DE POSGRADO E INVESTIGACION","ADMINISTRATIVO","EXTERNO"]),[b,E]=e.useState(null),[y,N]=e.useState(null);e.useEffect(()=>{async function e(){N(!0),E(null);try{const e=t=>{let n=t.replace(/\uFEFF/g,"");try{return JSON.parse(n)}catch(e){throw console.error("Error al analizar JSON:",e,n),new Error("El formato de un archivo de datos es incorrecto.")}},t=e=>(e||"").trim(),n=(e,t)=>{const n=Object.keys(e).find(n=>t.includes(n.trim().replace(/\uFEFF/g,"").toLowerCase()));return n?e[n]:void 0},a=async e=>{const t=await fetch(`${e}?v=${(new Date).getTime()}`);if(!t.ok)throw new Error(`No se pudo cargar el archivo: ${t.statusText}`);return t.text()},o=(await Promise.all([a(d.CURSOS),a(d.DOCENTES)])).map(e),s=o[0].map(e=>{const a=t=>n(e,t);return{id:a(["id_curso","id"]),name:a(["#","nombre_curso","nombre del curso","nombre"]),dates:a(["fechavisible","fechas"]),period:a(["periodo"]),hours:a(["horas"]),location:a(["lugar"]),schedule:a(["horario"]),type:a(["tipo"])}}).filter(e=>e.id&&e.name),c=o[1].map(e=>{const a=o=>n(e,o);return{nombreCompleto:t(a(["nombre completo","nombrecompleto","nombre"])),curp:t(a(["curp"])).toUpperCase(),email:t(a(["email"])).toLowerCase()}}).filter(e=>e.nombreCompleto);u(s.sort((e,t)=>e.period.localeCompare(t.period))),f(c)}catch(e){console.error("Error al cargar datos iniciales:",e),E(e.message)}finally{N(!1)}}();},[]);const C=async()=>{E(null);try{const e=await p(window.CONFIG.APPS_SCRIPT_URL,r,l);if("success"===e.status)i(t=>({...t,registrationId:e.registrationId})),s(4);else throw new Error(e.message||"Ocurrió un error desconocido.")}catch(e){E(e.message)}};const v=()=>{switch(t){case 1:return e.createElement(r,{formData:r,setFormData:i,departments:h,teachers:m,onNext:()=>s(2)});case 2:return e.createElement(i,{courses:l,selectedCourses:l.filter(e=>r.selectedCourses.includes(e.id)),setSelectedCourses:e=>{const t=e.map(e=>e.id);i(e=>({...e,selectedCourses:t}))},onNext:()=>s(3),onBack:()=>s(1)});case 3:return e.createElement(l,{formData:r,onBack:()=>s(2),onSubmit:C,courses:l.filter(e=>r.selectedCourses.includes(e.id))});case 4:return e.createElement(c,{registrationId:r.registrationId});default:return null}};return e.createElement("div",{className:"flex flex-col min-h-screen"},e.createElement(n,{}),e.createElement("div",{className:"border-b-8 border-blue-800"}),e.createElement("main",{className:"flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8"},e.createElement(o,{currentStep:t,steps:["Información Personal","Selección de Cursos","Confirmación","Registro Completo"]}),y?e.createElement("div",{className:"text-center text-gray-500"},"Cargando datos..."):(b&&e.createElement("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative max-w-4xl mx-auto",role:"alert"},e.createElement("strong",{className:"font-bold"},"Error: "),e.createElement("span",{className:"block sm:inline"},b)),v()))),e.createElement(a,{}))}t.createRoot(document.getElementById("root")).render(e.createElement(e.StrictMode,null,e.createElement(u,null)));
    </script>
</body>
</html>
